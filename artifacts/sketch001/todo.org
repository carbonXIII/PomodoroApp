#+TITLE: WIP things for user story 1

* Diagrams
** System Context [2021-02-12 Fri] 
#+begin_src plantuml :file ../images/001-system-context-diagram.png :exports results
title Overall System Context Diagram
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

Person(user, "Anon User")
Container(primary, "Pomodoro Application", "Java,Android", "Allow users to time the steps of the Pomodoro process while executing a task.")

Rel(user, primary, "Uses")
#+end_src

#+RESULTS:
[[file:../images/001-system-context-diagram.png]]

For this user story, there are no notications, only a single task is stored at
any given time, and there is no third-party integration.

** Container [2021-02-12 Fri]
#+begin_src plantuml :file ../images/001-container-diagram.png :exports results
title Overall Container Diagram
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

Person(user, "Anon User")
System_Boundary(c1, "Pomodoro Application") {
        Container(view, "UI", "Java, XML, Android SDK", "Handles UI")
        Container(api, "API", "Java", "The interface between our UI elements and the model. Handles validation and retrieval of model data for display.")
}

Rel(user, view, "Interacts With")
Rel(view, api, "Sends Client Events")
Rel(api, view, "Returns UI Data")
#+end_src

#+RESULTS:
[[file:../images/001-container-diagram.png]]

** Component [2021-02-12 Fri]
#+begin_src plantuml :file ../images/001-component-diagram.png :exports results
title Application Component Diagram (UI and API)
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

AddTagSupport("fragment", $bgColor="#42f581")
AddTagSupport("main", $bgColor="#f59e42")

Container(main, "Main Activity", "AppCompatActivity", "Handles switching between views/fragments.", $tags="main")
Container(ui, "Active Fragment", "Fragment", "The currently loaded Fragment, manages UI elements and UI events (timers, buttons).", $tags="fragment")

System_Boundary(c2, "API") {
        Container(newtask, "New Task Presenter", "Java", "Allows users to create a new task")
        Container(timer, "Timer Presenter", "Java", "Manages timer events for the 2 timer screens (work and break)")
        Container(continue, "Continue Presenter", "Java", "Allows the user to start the next timer, or mark a task as complete.")
        Container(task, "Task Model", "Java", "Manages information about the current task. Might be hooked up to a backend in the future.")
}

Rel_R(ui,main,"Register fragment class")

Rel(ui,newtask, "Subscribes To", $tags="fragment")
Rel_U(newtask, ui, "Updates UI Data", $tags="fragment")
Rel_U(newtask, main, "Switch to next screen")
Rel_D(newtask, task, "Create Task")

Rel(ui, timer, "", $tags="fragment")
Rel_U(timer, ui, "", $tags="fragment")
Rel_U(timer, main, "")
Rel_D(timer, task, "Fetch timer values, update task stats")

Rel(ui, continue, "", $tags="fragment")
Rel_U(continue, ui, "", $tags="fragment")
Rel_U(continue, main, "")
Rel_D(continue, task, "Update task completion status")

#+end_src

#+RESULTS:
[[file:../images/001-component-diagram.png]]

** Sequence [2021-02-11 Thu]
 #+begin_src plantuml :file ../images/001-sequence-diagram.png :exports results
title User Story 1 Sequence

actor User
participant View
participant Presenter
participant Model

User->View: starts app (launch main screen/activity)
loop
        loop task form loop
                Presenter->View: switch to new task screen
        == New Task Screen ==
                User->View: complete task form
                User->View: press ok button
                View->Presenter: new task form info
                Presenter->Presenter: validate task details
                alt task form valid
                        break exit task form loop
                                Presenter->Model: create new task object
                        end
                else form invalid
                        Presenter->View: show form validation error
                end
        end
        
        loop while task is not done
                Presenter->View: switch to timer screen
                == Work Timer Screen ==
                Presenter->Model: get task info
                Model->Presenter:
                Presenter->View: set timer title and subtitle
                loop while timer is not done
                        Presenter->View: update timer
                        opt
                                User-->View: optional break early
                                break exit timer loop
                                        View->Presenter: cancel timer
                                end
                        end
                end
                
                Presenter->View: switch to continue screen
                == Continue Screen ==
                Presenter->Model: get task info
                Model->Presenter:
                Presenter->View: set task name
                opt Task complete
                        User->View: selects done
                        break exit task loop
                                View->Presenter: done
                                Presenter->Model:  mark task as done
                        end
                end
                
                User->View: user selects continue
                View->Presenter: continue
                
                Presenter->View: switch to break timer screen
                == Break Timer Screen ==
                Presenter->Model: get task info
                Model->Presenter:
                Presenter->View: set timer title and subtitle

                loop while timer is not done
                        Presenter->View: update timer
                        opt
                                User-->View: optional break early
                                break exit timer loop
                                        View->Presenter: cancel timer
                                end
                        end
                end
        end
end
 #+end_src

   #+RESULTS:
   [[file:../images/001-sequence-diagram.png]]

* UI Sketch [2021-02-10 Wed]
** task setup screen
   [[../images/task_setup.png]]
** timer screens
*** working
    [[../images/timer_work.png]]
*** break
    [[../images/timer_break.png]]
** continue screen
   [[../images/continue.png]]
* Implement
** Layouts [2021-02-10 Wed]
*** headings
*** buttons
*** text input
*** timer
** Integration
*** fragment <-> layout mapping [2021-02-10 Wed] 
    Fairly straightforward:
#+BEGIN_SRC java
// Repace layout name with name of corresponding layout

import static org.team.app.R.layout.layout_name;

// ...

/* ... */ void onCreate( /* ... */  ) {
    super.onCreate(savedInstanceState);
    setContentView(layout_name);
}
#+END_SRC
*** presenter and (basic=no db) model
**** presenter
***** form validation
      will at least attempt TDD here
**** activity-presenter interaction
***** UI management interface
      - need to be able to update form data, but most of the UI code should
        still live in the activity not the presenter
      - one main activity that will serve as a Fragment Manager
#+begin_src java
        if(savedInstanceState == null) {
            getSupportFragmentManager().beginTransaction()
                .setReorderingAllowed(true)
                .add(R.id.fragmentContainerView, ExampleFragment.class, null)
                .commit();
        }
#+end_src
      - each screen will have it's UI code stored in a fragment
      - triggering screen transitions will be a function of the main activity
      - persistent info across quits needs to be stored in a bundle and saved to the back stack (?)
***** timers/events
      - need to be able to register presenters to handle events
      - need an enum of event types (or an event interface of some kind)
    
